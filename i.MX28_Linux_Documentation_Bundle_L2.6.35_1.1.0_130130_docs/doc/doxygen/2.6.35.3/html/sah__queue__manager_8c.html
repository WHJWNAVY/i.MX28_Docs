<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MXC Linux BSP: linux/drivers/mxc/security/sahara2/sah_queue_manager.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="contents">
<h1>linux/drivers/mxc/security/sahara2/sah_queue_manager.c File Reference</h1>This file provides a Queue Manager implementation.  
<a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#e4a01ac0018b290710aa99f0fa40b828">sah_Find_With_State</a> (sah_Queue_Status state)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="shw__driver_8h.html#4d2b660905d31e2f8d24ad6f13150b35">fsl_shw_return_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#0c621af218e34146e31ff51413df5ecc">sah_Queue_Manager_Init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#95dcf6476fb74ff0423a11b1b63d2a3e">sah_Queue_Manager_Close</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#d9e431a91a40846743d7df4bfb884285">sah_Queue_Manager_Count_Entries</a> (int ignore_state, sah_Queue_Status state)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#e9f2a78c257807d0cf1f07fb43f49d2e">sah_Queue_Manager_Remove_Entry</a> (<a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *entry)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#04be71755e1396c72e763da167210a6b">sah_Queue_Manager_Append_Entry</a> (<a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *entry)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#11c7a5159beeb1368d3c0059ec06395b">sah_Queue_Manager_Reset_Entries</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#d02aadbc22bd675abff38562e7193d8f">sah_Queue_Manager_Prime</a> (<a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *entry)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#8c7f5bcfdfc0478852c1200f04761705">sah_reset_sahara_request</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#6bb4dfbb60c8f7bdc144d2678f88fbe7">sah_process_finished_request</a> (<a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *desc_head, unsigned error)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#0958b06bd3ab1489a96b709307f75d43">sah_postprocess_queue</a> (unsigned long reset_flag)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="shw__driver_8h.html#4d2b660905d31e2f8d24ad6f13150b35">fsl_shw_return_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#29f3a5015d65f6e2f47118a11e62300d">sah_convert_error_status</a> (uint32_t error_status)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="portable__os_8h.html#a35d1aba68029da3351f918d97ab8e41">os_lock_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#0504adf9e314e9ab29a6f1dbb6393a44">desc_queue_lock</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structsah__Queue.html">sah_Queue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#99f84e895c2cedd13ce61b94f0828f23">main_queue</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">wait_queue_head_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sah__queue__manager_8c.html#899c56940d31bbc2f6857fa69899ac29">int_queue</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file provides a Queue Manager implementation. 
<p>
The Queue Manager manages additions and removal from the queue and updates the status of queue entries. It also calls sah_HW_* functions to interract with the hardware. <hr><h2>Function Documentation</h2>
<a class="anchor" name="29f3a5015d65f6e2f47118a11e62300d"></a><!-- doxytag: member="sah_queue_manager.c::sah_convert_error_status" ref="29f3a5015d65f6e2f47118a11e62300d" args="(uint32_t error_status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="shw__driver_8h.html#4d2b660905d31e2f8d24ad6f13150b35">fsl_shw_return_t</a> sah_convert_error_status           </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>error_status</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process the value from the Sahara error status register and convert it into an FSL SHW API error code.<p>
Warning, this routine must only be called if an error exists.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>error_status</em>&nbsp;</td><td>The value from the error status register.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>A return code of type <a class="el" href="group__lnkflags.html#g4d2b660905d31e2f8d24ad6f13150b35">fsl_shw_return_t</a>. </dd></dl>

<p>References <a class="el" href="shw__driver_8h-source.html#l00159">FSL_RETURN_ERROR_S</a>, and <a class="el" href="shw__driver_8h-source.html#l00183">FSL_RETURN_INTERNAL_ERROR_S</a>.</p>

<p>Referenced by <a class="el" href="sah__queue__manager_8c-source.html#l00415">sah_process_finished_request()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e4a01ac0018b290710aa99f0fa40b828"></a><!-- doxytag: member="sah_queue_manager.c::sah_Find_With_State" ref="e4a01ac0018b290710aa99f0fa40b828" args="(sah_Queue_Status state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a>* sah_Find_With_State           </td>
          <td>(</td>
          <td class="paramtype">sah_Queue_Status&nbsp;</td>
          <td class="paramname"> <em>state</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle the IDLE state. 
<p>
This is a helper function for Queue Manager. This function finds the first entry in the Queue Manager's queue whose state matches the given input state. This function starts at the head of the queue and works towards the tail. If a matching entry was found, the address of the entry is returned.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>state</em>&nbsp;</td><td>A sah_Queue_Status value.</td></tr>
  </table>
</dl>
<dl class="pre" compact><dt><b>Precondition:</b></dt><dd>The <a class="el" href="sah__queue__manager_8c.html#0504adf9e314e9ab29a6f1dbb6393a44">desc_queue_lock</a> must be held before calling this function.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>A pointer to a <a class="el" href="structsah__Head__Desc.html" title="The first descriptor in a chain.">sah_Head_Desc</a> that matches the given state. <p>
NULL otherwise. </dd></dl>

<p>Referenced by <a class="el" href="sah__status__manager_8c-source.html#l00088">sah_Handle_Interrupt()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00262">sah_Queue_Manager_Append_Entry()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00324">sah_Queue_Manager_Prime()</a>, and <a class="el" href="sah__queue__manager_8c-source.html#l00387">sah_reset_sahara_request()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0958b06bd3ab1489a96b709307f75d43"></a><!-- doxytag: member="sah_queue_manager.c::sah_postprocess_queue" ref="0958b06bd3ab1489a96b709307f75d43" args="(unsigned long reset_flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_postprocess_queue           </td>
          <td>(</td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>reset_flag</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Called from bottom half.<p>
<dl class="pre" compact><dt><b>Precondition:</b></dt><dd>The <a class="el" href="sah__queue__manager_8c.html#0504adf9e314e9ab29a6f1dbb6393a44">desc_queue_lock</a> may not be held when calling this function. </dd></dl>

<p>References <a class="el" href="sah__queue__manager_8c-source.html#l00129">desc_queue_lock</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00181">sah_Queue::head</a>, <a class="el" href="group__dkops.html#g8bcf7e7da2c6a3329cdaa32bf59c0cbc">os_lock_save_context()</a>, <a class="el" href="group__dkops.html#g059adc093b8dca445a4a4e8bfd89b540">os_unlock_restore_context()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00415">sah_process_finished_request()</a>, <a class="el" href="sah__queue_8c-source.html#l00165">sah_Queue_Remove_Entry()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00387">sah_reset_sahara_request()</a>, and <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00712">sah_Head_Desc::status</a>.</p>

<p>Referenced by <a class="el" href="sah__interrupt__handler_8c-source.html#l00205">sah_Intr_Bottom_Half()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6bb4dfbb60c8f7bdc144d2678f88fbe7"></a><!-- doxytag: member="sah_queue_manager.c::sah_process_finished_request" ref="6bb4dfbb60c8f7bdc144d2678f88fbe7" args="(sah_Head_Desc *desc_head, unsigned error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_process_finished_request           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *&nbsp;</td>
          <td class="paramname"> <em>desc_head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>error</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Post-process a descriptor chain after the hardware has finished with it.<p>
The status of the descriptor could also be checked. (for FATAL or IGNORED).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>desc_head</em>&nbsp;</td><td>The finished chain </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>error</em>&nbsp;</td><td>A boolean to mark whether hardware reported error</td></tr>
  </table>
</dl>
<dl class="pre" compact><dt><b>Precondition:</b></dt><dd>The <a class="el" href="sah__queue__manager_8c.html#0504adf9e314e9ab29a6f1dbb6393a44">desc_queue_lock</a> may not be held when calling this function. </dd></dl>

<p>References <a class="el" href="group__lnkflags.html#g0a9e68b33b76b4c230cf6a6a88321cbf">fsl_shw_uco_t::callback</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00129">desc_queue_lock</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00713">sah_Head_Desc::error_status</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00714">sah_Head_Desc::fault_address</a>, <a class="el" href="shw__driver_8h-source.html#l00159">FSL_RETURN_ERROR_S</a>, <a class="el" href="shw__driver_8h-source.html#l00157">FSL_RETURN_OK_S</a>, <a class="el" href="shw__driver_8h-source.html#l00114">FSL_UCO_BLOCKING_MODE</a>, <a class="el" href="shw__driver_8h-source.html#l00120">FSL_UCO_CALLBACK_MODE</a>, <a class="el" href="sah__interrupt__handler_8c-source.html#l00079">int_queue</a>, <a class="el" href="group__dkops.html#g8bcf7e7da2c6a3329cdaa32bf59c0cbc">os_lock_save_context()</a>, <a class="el" href="group__dkops.html#g059adc093b8dca445a4a4e8bfd89b540">os_unlock_restore_context()</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00716">sah_Head_Desc::result</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00541">sah_convert_error_status()</a>, <a class="el" href="sah__queue_8c-source.html#l00121">sah_Queue_Append_Entry()</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00712">sah_Head_Desc::status</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00711">sah_Head_Desc::uco_flags</a>, and <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00709">sah_Head_Desc::user_info</a>.</p>

<p>Referenced by <a class="el" href="sah__queue__manager_8c-source.html#l00459">sah_postprocess_queue()</a>.</p>

</div>
</div><p>
<a class="anchor" name="04be71755e1396c72e763da167210a6b"></a><!-- doxytag: member="sah_queue_manager.c::sah_Queue_Manager_Append_Entry" ref="04be71755e1396c72e763da167210a6b" args="(sah_Head_Desc *entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_Queue_Manager_Append_Entry           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *&nbsp;</td>
          <td class="paramname"> <em>entry</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Appends an entry to the Queue Manager's queue. 
<p>
This function appends an entry to the Queue Managers queue. It primes SAHARA if this entry is the first PENDING entry in the Queue Manager's Queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>entry</em>&nbsp;</td><td>A pointer to a <a class="el" href="structsah__Head__Desc.html" title="The first descriptor in a chain.">sah_Head_Desc</a> to append to the Queue Manager's queue.</td></tr>
  </table>
</dl>
<dl class="pre" compact><dt><b>Precondition:</b></dt><dd>The <a class="el" href="sah__queue__manager_8c.html#0504adf9e314e9ab29a6f1dbb6393a44">desc_queue_lock</a> may not may be held when calling this function.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>void </dd></dl>

<p>References <a class="el" href="sah__queue__manager_8c-source.html#l00129">desc_queue_lock</a>, <a class="el" href="group__dkops.html#g8bcf7e7da2c6a3329cdaa32bf59c0cbc">os_lock_save_context()</a>, <a class="el" href="group__dkops.html#g059adc093b8dca445a4a4e8bfd89b540">os_unlock_restore_context()</a>, <a class="el" href="sah__queue__manager_8c.html#e4a01ac0018b290710aa99f0fa40b828">sah_Find_With_State()</a>, <a class="el" href="sah__queue_8c-source.html#l00121">sah_Queue_Append_Entry()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00324">sah_Queue_Manager_Prime()</a>, and <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00712">sah_Head_Desc::status</a>.</p>

<p>Referenced by <a class="el" href="km__adaptor_8c-source.html#l00380">adaptor_Exec_Descriptor_Chain()</a>.</p>

</div>
</div><p>
<a class="anchor" name="95dcf6476fb74ff0423a11b1b63d2a3e"></a><!-- doxytag: member="sah_queue_manager.c::sah_Queue_Manager_Close" ref="95dcf6476fb74ff0423a11b1b63d2a3e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_Queue_Manager_Close           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close the Queue Manager. 
<p>
This function closes the Queue Manager<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>void </dd></dl>

<p>References <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00180">sah_Queue::count</a>, and <a class="el" href="sah__queue_8c-source.html#l00085">sah_Queue_Destroy()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d9e431a91a40846743d7df4bfb884285"></a><!-- doxytag: member="sah_queue_manager.c::sah_Queue_Manager_Count_Entries" ref="d9e431a91a40846743d7df4bfb884285" args="(int ignore_state, sah_Queue_Status state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sah_Queue_Manager_Count_Entries           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ignore_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">sah_Queue_Status&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Count the number of entries on the Queue Manager's queue<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ignore_state</em>&nbsp;</td><td>If non-zero, the <em>state</em> parameter is ignored. If zero, only entries matching <em>state</em> are counted. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>state</em>&nbsp;</td><td>State of entry to match for counting.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of entries which matched criteria </dd></dl>

<p>References <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00181">sah_Queue::head</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00717">sah_Head_Desc::next</a>, and <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00712">sah_Head_Desc::status</a>.</p>

</div>
</div><p>
<a class="anchor" name="0c621af218e34146e31ff51413df5ecc"></a><!-- doxytag: member="sah_queue_manager.c::sah_Queue_Manager_Init" ref="0c621af218e34146e31ff51413df5ecc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="shw__driver_8h.html#4d2b660905d31e2f8d24ad6f13150b35">fsl_shw_return_t</a> sah_Queue_Manager_Init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialise the Queue Manager. 
<p>
This function initialises the Queue Manager<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FSL_RETURN_OK_S on success; FSL_RETURN_MEMORY_ERROR_S if not </dd></dl>

<p>References <a class="el" href="sah__queue__manager_8c-source.html#l00129">desc_queue_lock</a>, <a class="el" href="shw__driver_8h-source.html#l00181">FSL_RETURN_MEMORY_ERROR_S</a>, <a class="el" href="shw__driver_8h-source.html#l00157">FSL_RETURN_OK_S</a>, <a class="el" href="group__dkops.html#gd4338ff9bdad14659d26d388971e65f9">os_lock_alloc_init()</a>, and <a class="el" href="sah__queue_8c-source.html#l00050">sah_Queue_Construct()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d02aadbc22bd675abff38562e7193d8f"></a><!-- doxytag: member="sah_queue_manager.c::sah_Queue_Manager_Prime" ref="d02aadbc22bd675abff38562e7193d8f" args="(sah_Head_Desc *entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_Queue_Manager_Prime           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *&nbsp;</td>
          <td class="paramname"> <em>entry</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prime SAHARA. 
<p>
This function primes SAHARA for the first time or after the queue becomes empty. Queue lock must have been set by the caller of this routine.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>entry</em>&nbsp;</td><td>A pointer to a <a class="el" href="structsah__Head__Desc.html" title="The first descriptor in a chain.">sah_Head_Desc</a> to Prime SAHARA with.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>void </dd></dl>

<p>References <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00708">sah_Head_Desc::desc</a>, <a class="el" href="sah__queue__manager_8c.html#e4a01ac0018b290710aa99f0fa40b828">sah_Find_With_State()</a>, <a class="el" href="sah__hardware__interface_8c-source.html#l00440">sah_HW_Read_DAR()</a>, <a class="el" href="sah__hardware__interface_8c-source.html#l00560">sah_HW_Write_DAR()</a>, and <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00712">sah_Head_Desc::status</a>.</p>

<p>Referenced by <a class="el" href="sah__queue__manager_8c-source.html#l00262">sah_Queue_Manager_Append_Entry()</a>, and <a class="el" href="sah__queue__manager_8c-source.html#l00387">sah_reset_sahara_request()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e9f2a78c257807d0cf1f07fb43f49d2e"></a><!-- doxytag: member="sah_queue_manager.c::sah_Queue_Manager_Remove_Entry" ref="e9f2a78c257807d0cf1f07fb43f49d2e" args="(sah_Head_Desc *entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_Queue_Manager_Remove_Entry           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsah__Head__Desc.html">sah_Head_Desc</a> *&nbsp;</td>
          <td class="paramname"> <em>entry</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Remove an entry from the Queue Manager's queue. 
<p>
This function removes an entry from the Queue Manager's queue. The entry to be removed can be anywhere in the queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>entry</em>&nbsp;</td><td>A pointer to a <a class="el" href="structsah__Head__Desc.html" title="The first descriptor in a chain.">sah_Head_Desc</a> to remove from the Queue Manager's queue.</td></tr>
  </table>
</dl>
<dl class="pre" compact><dt><b>Precondition:</b></dt><dd>The <a class="el" href="sah__queue__manager_8c.html#0504adf9e314e9ab29a6f1dbb6393a44">desc_queue_lock</a> must be held before calling this function.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>void </dd></dl>

<p>References <a class="el" href="sah__queue_8c-source.html#l00188">sah_Queue_Remove_Any_Entry()</a>.</p>

</div>
</div><p>
<a class="anchor" name="11c7a5159beeb1368d3c0059ec06395b"></a><!-- doxytag: member="sah_queue_manager.c::sah_Queue_Manager_Reset_Entries" ref="11c7a5159beeb1368d3c0059ec06395b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_Queue_Manager_Reset_Entries           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Mark all entries with state SAH_STATE_RESET. 
<p>
This function marks all entries in the Queue Manager's queue with state SAH_STATE_RESET.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>void</dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This feature needs re-visiting </dd></dl>

<p>References <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00181">sah_Queue::head</a>, <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00717">sah_Head_Desc::next</a>, and <a class="el" href="kernel_22_86_835_83_2linux_2drivers_2mxc_2security_2sahara2_2include_2sahara_8h-source.html#l00712">sah_Head_Desc::status</a>.</p>

</div>
</div><p>
<a class="anchor" name="8c7f5bcfdfc0478852c1200f04761705"></a><!-- doxytag: member="sah_queue_manager.c::sah_reset_sahara_request" ref="8c7f5bcfdfc0478852c1200f04761705" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sah_reset_sahara_request           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reset SAHARA, then load the next descriptor on it, if one exists 
<p>References <a class="el" href="sah__queue__manager_8c-source.html#l00129">desc_queue_lock</a>, <a class="el" href="group__dkops.html#g8bcf7e7da2c6a3329cdaa32bf59c0cbc">os_lock_save_context()</a>, <a class="el" href="group__dkops.html#g059adc093b8dca445a4a4e8bfd89b540">os_unlock_restore_context()</a>, <a class="el" href="sah__queue__manager_8c.html#e4a01ac0018b290710aa99f0fa40b828">sah_Find_With_State()</a>, <a class="el" href="sah__hardware__interface_8c-source.html#l00128">sah_HW_Reset()</a>, and <a class="el" href="sah__queue__manager_8c-source.html#l00324">sah_Queue_Manager_Prime()</a>.</p>

<p>Referenced by <a class="el" href="sah__queue__manager_8c-source.html#l00459">sah_postprocess_queue()</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="0504adf9e314e9ab29a6f1dbb6393a44"></a><!-- doxytag: member="sah_queue_manager.c::desc_queue_lock" ref="0504adf9e314e9ab29a6f1dbb6393a44" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="portable__os_8h.html#a35d1aba68029da3351f918d97ab8e41">os_lock_t</a> <a class="el" href="sah__queue__manager_8c.html#0504adf9e314e9ab29a6f1dbb6393a44">desc_queue_lock</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This lock must be held while performing any queuing or unqueuing functions, including reading the first pointer on the queue. It also protects reading and writing the Sahara DAR register. It must be held during a read-write operation on the DAR so that the 'test-and-set' is atomic. 
<p>Referenced by <a class="el" href="sah__status__manager_8c-source.html#l00088">sah_Handle_Interrupt()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00459">sah_postprocess_queue()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00415">sah_process_finished_request()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00262">sah_Queue_Manager_Append_Entry()</a>, <a class="el" href="sah__queue__manager_8c-source.html#l00151">sah_Queue_Manager_Init()</a>, and <a class="el" href="sah__queue__manager_8c-source.html#l00387">sah_reset_sahara_request()</a>.</p>

</div>
</div><p>
<a class="anchor" name="899c56940d31bbc2f6857fa69899ac29"></a><!-- doxytag: member="sah_queue_manager.c::int_queue" ref="899c56940d31bbc2f6857fa69899ac29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">wait_queue_head_t* <a class="el" href="sah__queue__manager_8c.html#899c56940d31bbc2f6857fa69899ac29">int_queue</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This is set by the Initialisation function 
<p>Referenced by <a class="el" href="sah__queue__manager_8c-source.html#l00415">sah_process_finished_request()</a>.</p>

</div>
</div><p>
<a class="anchor" name="99f84e895c2cedd13ce61b94f0828f23"></a><!-- doxytag: member="sah_queue_manager.c::main_queue" ref="99f84e895c2cedd13ce61b94f0828f23" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsah__Queue.html">sah_Queue</a>* <a class="el" href="sah__queue__manager_8c.html#99f84e895c2cedd13ce61b94f0828f23">main_queue</a> = NULL          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This is the main queue for the driver. This is shared between all threads and is not protected by mutexes since the kernel is non-preemptable. 
</div>
</div><p>
</div>
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<Title>footer</Title>
</HEAD>
<BODY>
</ul>
</ul>
</ul>
</ul>
<hr size="1">
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber1">
  <tr>
    <td width="50%"><small>©&nbsp; Freescale Semiconductor, Inc., 2007.&nbsp; 
    All rights reserved.<br>
    </small><FONT COLOR="#FF0000"><small>Freescale Confidential Proprietary<br>
    </small></FONT><small><FONT COLOR="#FF0000">NDA Required</FONT></small></td>
    <td width="50%"><small>
<a href="http://www.doxygen.org/index.html">
<img src="Freescale25.png" alt="doxygen" align="right" border="0" width="129" height="48"></a></small></td>
  </tr>
</table>
<address style="align: right;">&nbsp;</address>
</body>
</html>
